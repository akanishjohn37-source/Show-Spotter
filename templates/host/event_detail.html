{% extends 'base.html' %}

{% block title %}Manage: {{ event.title }}{% endblock %}

{% block content %}
<div style="margin-bottom: 2rem;">
    <a href="{% url 'host_dashboard' %}" class="btn-text">&larr; Back to Dashboard</a>
</div>

<h1 style="margin-bottom: 2rem;">Analytics: {{ event.title }}</h1>

<!-- Stats Cards -->
<div
    style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1.5rem; margin-bottom: 3rem;">
    <div class="card" style="text-align: center;">
        <h3 style="color: var(--text-muted);">Total Revenue</h3>
        <p style="font-size: 2.5rem; font-weight: bold; margin: 0.5rem 0; color: var(--accent);">${{ total_revenue }}
        </p>
    </div>
    <div class="card" style="text-align: center;">
        <h3 style="color: var(--text-muted);">Seats Sold</h3>
        <p style="font-size: 2.5rem; font-weight: bold; margin: 0.5rem 0;">{{ seats_sold_count }} <span
                style="font-size: 1rem; color: var(--text-muted);">/ {{ total_capacity }}</span></p>
    </div>
    <div class="card" style="text-align: center;">
        <h3 style="color: var(--text-muted);">Remaining Seats</h3>
        <p style="font-size: 2.5rem; font-weight: bold; margin: 0.5rem 0;">{{ balance_seats }}</p>
    </div>
</div>

<!-- Seat Map -->
<div class="card">
    <h2 style="margin-bottom: 1.5rem; text-align: center;">Live Seat Map</h2>

    <div class="seat-legend" style="display: flex; justify-content: center; gap: 1.5rem; margin-bottom: 2rem;">
        <div style="display: flex; align-items: center; gap: 0.5rem;">
            <div class="seat" style="width: 20px; height: 20px; cursor: default;"></div> Available
        </div>
        <div style="display: flex; align-items: center; gap: 0.5rem;">
            <div class="seat booked" style="width: 20px; height: 20px; cursor: default;"></div> Booked
        </div>
    </div>

    <div id="seat-grid" class="seat-grid" style="grid-template-columns: repeat({{ event.venue_cols }}, 40px);">
        <!-- Seats generated by JS -->
    </div>
</div>

<script>
    const venueRows = {{ event.venue_rows }};
    const venueCols = {{ event.venue_cols }};
    const bookedSeats = {{ booked_seats| safe }};

    document.addEventListener('DOMContentLoaded', function () {
        const grid = document.getElementById('seat-grid');

        for (let r = 1; r <= venueRows; r++) {
            for (let c = 1; c <= venueCols; c++) {
                const seatId = `${String.fromCharCode(64 + r)}${c}`;
                const seat = document.createElement('div');
                seat.classList.add('seat');
                seat.textContent = seatId;
                seat.style.cursor = 'default'; // Host view is read-only

                if (bookedSeats.includes(seatId)) {
                    seat.classList.add('booked');
                    seat.title = "Booked";
                }

                grid.appendChild(seat);
            }
        }
    });
</script>
{% endblock %}